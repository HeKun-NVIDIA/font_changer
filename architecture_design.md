# PPT字体修改网站架构设计

## 系统整体架构

### 技术栈选择
- **前端**: React + TypeScript + Tailwind CSS
- **后端**: Flask + Python 3.11
- **文件处理**: python-pptx
- **文件存储**: 本地临时存储
- **字体管理**: 系统字体 + 自定义字体文件

### 系统架构图
```
┌─────────────────┐    ┌─────────────────┐    ┌─────────────────┐
│   前端 React    │    │   后端 Flask    │    │   字体处理器    │
│                 │    │                 │    │                 │
│ - 文件上传      │◄──►│ - API接口       │◄──►│ - 字体检测      │
│ - 进度显示      │    │ - 文件处理      │    │ - 字体替换      │
│ - 结果下载      │    │ - 错误处理      │    │ - 格式保持      │
└─────────────────┘    └─────────────────┘    └─────────────────┘
         │                       │                       │
         │                       │                       │
         ▼                       ▼                       ▼
┌─────────────────┐    ┌─────────────────┐    ┌─────────────────┐
│   用户界面      │    │   文件管理      │    │   PPT处理引擎   │
│                 │    │                 │    │                 │
│ - 拖拽上传      │    │ - 临时存储      │    │ - python-pptx   │
│ - 实时反馈      │    │ - 文件清理      │    │ - 文本解析      │
│ - 错误提示      │    │ - 安全检查      │    │ - Run重构       │
└─────────────────┘    └─────────────────┘    └─────────────────┘
```

## 核心模块设计

### 1. 字体处理核心模块

```python
class FontProcessor:
    """字体处理核心类"""
    
    def __init__(self, chinese_font="Noto Sans SC", english_font="NVIDIA Sans"):
        self.chinese_font = chinese_font
        self.english_font = english_font
    
    def process_presentation(self, ppt_path: str) -> str:
        """处理整个演示文稿"""
        pass
    
    def process_slide(self, slide) -> None:
        """处理单个幻灯片"""
        pass
    
    def process_shape(self, shape) -> None:
        """处理单个形状中的文本"""
        pass
    
    def process_paragraph(self, paragraph) -> None:
        """处理段落，实现字符级字体替换"""
        pass
    
    def detect_char_type(self, char: str) -> str:
        """检测字符类型（中文/英文/其他）"""
        pass
```

### 2. API接口设计

```python
# Flask API 端点设计

@app.route('/api/upload', methods=['POST'])
def upload_file():
    """文件上传接口"""
    pass

@app.route('/api/process', methods=['POST'])
def process_ppt():
    """PPT处理接口"""
    pass

@app.route('/api/download/<file_id>', methods=['GET'])
def download_file(file_id):
    """文件下载接口"""
    pass

@app.route('/api/status/<task_id>', methods=['GET'])
def get_status(task_id):
    """获取处理状态"""
    pass
```

### 3. 前端组件架构

```typescript
// React 组件结构
src/
├── components/
│   ├── FileUpload/
│   │   ├── DropZone.tsx          // 拖拽上传区域
│   │   ├── FileList.tsx          // 文件列表
│   │   └── UploadProgress.tsx    // 上传进度
│   ├── Processing/
│   │   ├── StatusDisplay.tsx     // 处理状态显示
│   │   ├── ProgressBar.tsx       // 进度条
│   │   └── ErrorMessage.tsx      // 错误信息
│   └── Download/
│       ├── DownloadButton.tsx    // 下载按钮
│       └── ResultPreview.tsx     // 结果预览
├── services/
│   ├── api.ts                    // API调用服务
│   ├── fileService.ts            // 文件处理服务
│   └── fontService.ts            // 字体相关服务
└── types/
    ├── api.ts                    // API类型定义
    └── file.ts                   // 文件类型定义
```

## 用户界面设计

### 主页面布局

```
┌─────────────────────────────────────────────────────────────┐
│                        页面标题                             │
│                   PPT字体自动替换工具                        │
├─────────────────────────────────────────────────────────────┤
│                                                             │
│  ┌─────────────────────────────────────────────────────┐   │
│  │                                                     │   │
│  │              拖拽上传区域                           │   │
│  │                                                     │   │
│  │     📁 拖拽PPT文件到此处或点击选择文件              │   │
│  │                                                     │   │
│  │     支持格式: .pptx                                 │   │
│  │     最大文件: 50MB                                  │   │
│  │                                                     │   │
│  └─────────────────────────────────────────────────────┘   │
│                                                             │
│  ┌─────────────────────────────────────────────────────┐   │
│  │ 字体设置                                            │   │
│  │ 中文字体: Noto Sans SC     ✓                       │   │
│  │ 英文字体: NVIDIA Sans      ✓                       │   │
│  └─────────────────────────────────────────────────────┘   │
│                                                             │
│  ┌─────────────────────────────────────────────────────┐   │
│  │ 处理进度                                            │   │
│  │ ████████████████████████████████████████ 100%      │   │
│  │ 正在处理第 5/10 张幻灯片...                         │   │
│  └─────────────────────────────────────────────────────┘   │
│                                                             │
│  ┌─────────────────────────────────────────────────────┐   │
│  │ 下载结果                                            │   │
│  │ [📥 下载处理后的PPT文件]                            │   │
│  └─────────────────────────────────────────────────────┘   │
│                                                             │
└─────────────────────────────────────────────────────────────┘
```

### 交互流程设计

1. **文件上传阶段**
   - 拖拽或点击上传PPT文件
   - 实时文件验证（格式、大小）
   - 上传进度显示

2. **处理阶段**
   - 显示处理进度
   - 实时状态更新
   - 错误处理和提示

3. **下载阶段**
   - 处理完成提示
   - 下载按钮激活
   - 文件预览（可选）

### 响应式设计

- **桌面端**: 1200px+ 宽度，完整功能布局
- **平板端**: 768px-1199px，紧凑布局
- **移动端**: <768px，垂直堆叠布局

## 安全性设计

### 文件安全
- 文件类型验证
- 文件大小限制
- 病毒扫描（可选）
- 临时文件自动清理

### 数据安全
- 文件加密存储
- 处理后自动删除
- 无用户数据收集
- HTTPS传输

## 性能优化

### 前端优化
- 组件懒加载
- 文件分片上传
- 进度实时更新
- 错误重试机制

### 后端优化
- 异步文件处理
- 任务队列管理
- 内存使用优化
- 并发处理限制

## 错误处理

### 常见错误类型
1. 文件格式不支持
2. 文件损坏或无法解析
3. 字体文件缺失
4. 处理超时
5. 服务器错误

### 错误处理策略
- 友好的错误提示
- 详细的错误日志
- 自动重试机制
- 降级处理方案

这个架构设计充分考虑了字符级字体替换的复杂性，确保系统能够准确处理中英文混合文本，同时提供良好的用户体验。

